จาก [Sprague---Grundy theorem](https://en.wikipedia.org/wiki/Sprague%E2%80%93Grundy_theorem) เราสามารถมองเกมตัดเชือกได้ว่าเป็นเกมเดียวกับ Nim โดยที่

- แต่ละเกมย่อยที่เป็นอิสระจากกัน จะมี Grundy value เท่ากับ MEX ของ Grundy value ของสถานะเกมที่เกิดจากทางเลือกการเดินเกมทุกเส้นทางที่ทำได้
- เกมรวม (สิ่งที่เราสนใจ) จะมี Grundy value เท่ากับ XOR ของ Grundy value ของเกมย่อย
- ถ้าเกมรวมมี Grundy value เป็น 0 ในตาเรา เราจะแพ้ มิเช่นนั้นเราจะชนะ

(MEX ของเซตจำนวนนับ มีค่าเท่ากับจำนวนนับแรกที่ไม่ปรากฏในเซต เช่น MEX ของ $\{0,1,3,6,7\}$ เท่ากับ $2$)

สมมุติว่าเกมประกอบไปด้วยเส้นเชือกที่ไม่ได้ขดเป็นวงเพียง 1 เส้น ความยาว $x$ เรียก Grundy value ของเกมในกรณีดังกล่าวว่า $g(x)$
- $g(1) = 0$ เพราะเชือกความยาว 1 ไม่สามารถทำอะไรต่อได้
- $g(2) = MEX\{g(1)\} = 1$ เพราะวิธีเดียวที่ทำได้คือแบ่งเชือกออกเป็นสองเส้น เส้นความยาว 1 หน่วยแล้วเก็บไว้เส้นเดียว
- $g(3) = MEX\{g(2)\} = 0$ เพราะวิธีเดียวที่ทำได้คือแบ่งเชือกออกเป็นเส้นความยาว 2 หน่วยและ 1 หน่วย แล้วเก็บเส้นความยาว 2 หน่วยไว้
- $g(4) = MEX\{g(3), g(2)\} = MEX\{0, 1\} = 2$ เพราะทำได้สองวิธี คือแบ่งเชือกออกเป็น $(3,1)$ แล้วเก็บ $3$ ไว้ หรือแบ่งเชือกออกเป็น $(2,2)$ แล้วเก็บ $2$ ไว้
- $g(5) = MEX\{g(4), g(3)\} = MEX\{2, 0\} = 1$
- $g(6) = MEX\{g(5), g(4), g(3)\} = MEX\{1, 2, 0\} = 3$

หากลองคำนวณไปเรื่อย ๆ จะสังเกตได้ว่า
$$g(x) = \begin{cases}
  0  &; x=1 \\
  \frac{x}{2} &; 2 \mid x \\
  g(\frac{x-1}{2}) &; 2 \nmid x
\end{cases}$$

ดังนั้นเราสามารถคำนวณ $g(x)$ ได้ใน $O(\log x)$ (ในโจทย์ข้อนี้ $x \leq 10^{12}$)

สมมุติว่าเกมประกอบไปด้วยเส้นเชือกที่ขดเป็นวง 1 เส้น ความยาว $x$ เราสามารถเดินเกมได้สองแบบคือ

- ตัดให้เป็นเส้นเชือกที่ไม่ได้ขดเป็นวง 1 เส้น ความยาว $x$
- ตัดให้เป็นเส้นเชือกที่ไม่ได้ขดเป็นวง 1 เส้น ความยาว $x-1$ เราสามารถคิด Grundy value ของทั้งสองกรณี แล้วหา MEX จะได้เป็น Grundy value ของเกมนี้ สังเกตว่าจะมีค่าอยู่ระหว่าง $0$ ถึง $2$ เสมอ เพราะค่า MEX ที่มากที่สุดที่เป็นไปได้เกิดเมื่อสองกรณีข้างต้นให้ Grundy value เป็น $0$ และ $1$ ทำให้เลขตัวแรกที่ไม่ปรากฏคือเลข $2$

ดังนั้น สำหรับโจทย์ข้อนี้ เราพิจารณาเกมรวมที่ประกอบด้วยเส้นที่ขดเป็นวงหลายเส้น เราสามารถหาคำตอบได้โดยหา Grundy value ของแต่ละวงแล้วนำมา XOR กัน ได้เป็น Grundy value ของเกมรวมนี้ หากมีค่าเท่ากับ 0 เราจะแพ้ มิเช่นนั้นเราจะชนะ

Time Complexity คือ $O(N \log \max X_i)$ ต่อ 1 ชุดทดสอบ

## Implementation

ในภาษา C++:

```cpp
#include <bits/stdc++.h>
using namespace std;
using ll = long long;

ll grundy(ll i) {
  if (i == 0)
    return 0;
  else if (i % 2 == 0)
    return i / 2;
  else
    return grundy(i / 2);
}

int circle(ll n) {
  int cnt[3] = {};
  ll x1 = grundy(n);
  if (x1 < 3)
    ++cnt[x1];
  ll x2 = grundy(n - 1);
  if (x2 < 3)
    ++cnt[x2];
  for (int i = 0; i < 3; ++i) {
    if (!cnt[i])
      return i;
  }
  assert(false); // impossible to reach this point
}

int main() {
  int k;
  scanf("%d", &k);
  while (k--) {
    int n;
    scanf("%d", &n);
    int ans = 0;
    for (int i = 0; i < n; ++i) {
      ll x;
      scanf("%lld", &x);
      ans ^= circle(x);
    }
    printf("%d\n", ans == 0 ? 0 : 1);
  }

  return 0;
}
```

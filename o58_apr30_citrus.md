ก่อนอื่น สังเกตว่าเราสามารถใช้ Floyd-Warshall Algorithm เพื่อให้มั่นใจว่า $A_{x,y} =$ ค่าใช้จ่ายที่น้อยที่สุดที่เราสามารถแปลงจากไพ่สี $x$ เป็นไพ่สี $y$ ได้ ดังนั้นการเปลี่ยนสีไพ่สามารถทำได้ด้วยการกระทำเพียงครั้งเดียวเสมอ ขั้นตอนนี้มี Time Complexity เป็น $O(K^3)$

โจทย์ข้อนี้สามารถแก้ได้ด้วย Dynamic Programming

นิยามให้ $dp[l][r][c] =$ ค่าใช้จ่ายที่น้อยที่สุดในการทำให้ไพ่ใบที่ $l$ ถึง $r$ เหลือเพียงใบเดียวและเป็นสี $c$ ($1 \leq l \leq r \leq N$, $1 \leq c \leq K$)

สำหรับแต่ละช่วง $[l,r]$ ที่ $l < r$ เราจะคำนวณสูตรนี้สำหรับ $c=1,2,3,\dots,K$ ก่อน:

$$dp[l][r][c] = \min\limits_{l \leq i \leq r} \left( dp[l][i][b] + dp[i+1][r][b] + B[b]\right)$$

($b$ คือค่าที่ทำให้ $c = next(b)$)

นั่นคือ เราจะมองว่าเหลือไพ่อยู่สองใบที่มีสี $b$ เหมือนกัน โดยใบซ้ายมาจากช่วง $[l,i]$ ที่ถูกรวบเหลือใบเดียวแล้ว ส่วนใบขวามาจากช่วง $[i+1,r]$ แล้วเรานำไพ่สองใบนี้มารวบด้วยค่าใช้จ่าย $B[b]$ ได้ไพ่ใบเดียวที่มีสี $c$

(สำหรับ base case $l = r$ ให้ $dp[l][r][c] = 0$ ถ้า $c$ ตรงกับสีเริ่มต้นของไพ่ใบที่ $l$ มิเช่นนั้นให้ $dp[l][r][c] = \infty$)

ตาราง $dp[l][r][c]$ ของเรายังไม่ถูกต้องเพราะยังไม่ได้พิจารณาการเปลี่ยนสีไพ่หลังจากรวบเสร็จ ดังนั้นจึงต้องคำนวณสูตรนี้สำหรับ $c=1,2,3,\dots,K$:

$$dp[l][r][c] = \min\limits_{1 \leq x \leq K}\left(  dp[l][r][x] + A[x][c]\right)$$

หากคำนวณสองสูตรดังกล่าวตามลำดับสำหรับแต่ละช่วง $[i,j]$ ไล่ตั้งแต่ช่วงที่มีขนาดเล็กสุด (ความยาว $1$) มาขนาดใหญ่สุด (ความยาว $N$) จะได้คำตอบเท่ากับ

$$\min\limits_{1 \leq c \leq K} \left( dp[1][n][c] \right)$$
